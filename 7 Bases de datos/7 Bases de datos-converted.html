<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>7 Bases de datos</title>
<script src="https://kit.fontawesome.com/df26033572.js"></script>
<style type="text/css">html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
  .typora-export h1::after, .typora-export h2::after, .typora-export h3::after, .typora-export h4::after, .typora-export h5::after, .typora-export h6::after { content: ""; display: block; height: 100px; margin-bottom: -100px; }
}


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space:inherit; overflow-x: visible; }
.first-line-indent #write p .md-line { text-indent: 0px; }
.first-line-indent #write li, .first-line-indent #write p, .first-line-indent #write p .md-line:first-child { text-indent: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write > blockquote:first-child, #write > div:first-child, #write > figure:first-child, #write > ol:first-child, #write > p:first-child, #write > pre:first-child, #write > ul:first-child { margin-top: 30px; }
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
h1, h2, h3, h4, h5, h6 { margin-top: 1rem; margin-bottom: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0px; -webkit-margin-after: 0px; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
pre.contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.CodeMirror-line { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
.footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > img:only-child { display: block; margin: auto; }
.md-line > .md-image:only-child, p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, tt { font-family: var(--monospace); }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; padding-bottom: 30px; height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { background-color: infobackground; border: 1px solid rgb(0, 0, 0); border-radius: 4px; color: infotext; font-family: var(--monospace); overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; transition: opacity 0.4s; font-size: 0.8em; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: left bottom; background-repeat: repeat-x; }
.CodeMirror-lint-mark-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg=="); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { background-position: center center; background-repeat: no-repeat; cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: left top; background-repeat: no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-multiple { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC"); background-repeat: no-repeat; background-position: right bottom; width: 100%; height: 100%; }


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(223, 226, 229); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media screen and (min-width: 914px) {
}
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }


.cm-s-inner { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); }
.cm-s-inner .CodeMirror-gutters { background: rgb(38, 50, 56); color: rgb(83, 127, 126); border: none; }
.cm-s-inner .CodeMirror-guttermarker, .cm-s-inner .CodeMirror-guttermarker-subtle, .cm-s-inner .CodeMirror-linenumber { color: rgb(83, 127, 126); }
.cm-s-inner .CodeMirror-cursor { border-left: 1px solid rgb(248, 248, 240); }
.cm-s-inner div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line > span::selection, .cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }
.cm-s-inner .cm-keyword { color: rgb(199, 146, 234); }
.cm-s-inner .cm-operator { color: rgb(233, 237, 237); }
.cm-s-inner .cm-variable-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-variable-3 { color: rgb(130, 177, 255); }
.cm-s-inner .cm-builtin { color: rgb(222, 203, 107); }
.cm-s-inner .cm-atom { color: rgb(247, 118, 105); }
.cm-s-inner .cm-number { color: rgb(247, 118, 105); }
.cm-s-inner .cm-def { color: rgb(233, 237, 237); }
.cm-s-inner .cm-string { color: rgb(195, 232, 141); }
.cm-s-inner .cm-string-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-comment { color: rgb(84, 110, 122); }
.cm-s-inner .cm-variable { color: rgb(130, 177, 255); }
.cm-s-inner .cm-tag { color: rgb(128, 203, 196); }
.cm-s-inner .cm-meta { color: rgb(128, 203, 196); }
.cm-s-inner .cm-attribute { color: rgb(255, 203, 107); }
.cm-s-inner .cm-property { color: rgb(128, 203, 174); }
.cm-s-inner .cm-qualifier { color: rgb(222, 203, 107); }
.cm-s-inner .cm-variable-3 { color: rgb(222, 203, 107); }
.cm-s-inner .cm-tag { color: rgb(255, 83, 112); }
.cm-s-inner .cm-error { color: rgb(255, 255, 255); background-color: rgb(236, 95, 103); }
.cm-s-inner .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }
.md-fences { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); border: none; }
.md-fences .code-tooltip { background-color: rgb(38, 50, 56); }
.md-diagram-panel { font-family: Arial; font-size: 14px; line-height: 16px; }

.typora-export p, .typora-export .footnote-line {white-space: normal;} 
iframe{
width:auto;
}



</style>
<style type='text/css'>
body.typora-export{
    padding-left: 0;
    padding-right: 0;
    background-color: #f8f8f8;
}
#write-wrapper{
    margin:0px auto;
    margin-top: 80px;
    margin-bottom: 80px;
    max-width: 960px;
    background-color: #fff;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0),0 0 1Z0px rgba(0, 0, 0, 0.1);
    border: 1px solid #c2c2c2;
    
}
#write, #custom-footer{
    max-width: 100%;
}
#write{
	padding: 80px 80px 100px
}
.typora-menu  {
    left:0;
    position: fixed;
    top: 0;
    bottom: 0;
    z-index: 10;
    overflow-y: auto;
    width: 300px;
    color: #364149;
    background: #2c2c2c;
    border-right: 1px solid rgba(0,0,0,.07);
    -webkit-transition: left 250ms ease;
    -moz-transition: left 250ms ease;
    -o-transition: left 250ms ease;
    transition: left 250ms ease;
    opacity: .9;
}
.hide-menu .typora-menu{
    left:-300px;
}
.main-content{
    top: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    color: #000;
}
#nav-previous, #nav-next, .top a.toogle{
  -webkit-transition: left 250ms ease;
    -moz-transition: left 250ms ease;
    -o-transition: left 250ms ease;
    transition: left 250ms ease;
    background-color: #2c2c2c;
    opacity: .9;
}
.hide-menu #nav-previous, .hide-menu #nav-next, .hide-menu .top a.toogle{
    left: 0;
}

.hide-menu .main-content{
    margin-left:0px;
}

.md-toc-item a{
    display: block;
    padding: 4px 4px;
    border-bottom: none;
    color: #fafafa;
    background: 0 0;
    position: relative;
    outline: none;
}
.top{
    position: fixed;
    top:0;
    z-index: 4;
    width: 30%;
}

.top a.toogle{
    color:#c2c2c2;
    padding: 8px;
    height: 30px;
    left: 300px;
    position: fixed;
    padding-top:2px;
}
#nav-previous{
    color:#c2c2c2;
    padding: 8px;
    left: 300px;
    position: fixed;
    top: 30px;
    height: 30px;
    padding-top:2px;
}
#nav-next{
    color:#c2c2c2;
    padding: 8px;
    left: 300px;
    position: fixed;
    top: 60px;
    height: 30px;
    padding-top:2px;
}
.top a.toogle:hover, .top a.toogle:focus, #nav-previous:hover, #nav-next:hover, #nav-previous:focus, #nav-next:focus{
    color:rgb(65, 131, 196);
}
.md-toc-content a{
    border-left: 1px solid transparent;
}
.md-toc-content a.active{
    border-left: 1px solid #fafafa;
    color:rgb(65, 131, 196);
}
.md-toc-h1 .md-toc-inner{
    font-weight: inherit;
}
.md-toc-h2 .md-toc-inner{
    margin-left: 0.4em;
}
.md-toc-h3 .md-toc-inner{
    margin-left: 2em;
}
.md-toc-h4 .md-toc-inner{
    margin-left: 3em;
}
.md-toc-h5 .md-toc-inner{
    margin-left: 4em;
}
.md-toc-h6 .md-toc-inner{
    margin-left: 5em;
}

.md-toc-h1 a.md-toc-inner{
    font-size: 1.3rem;
}

.raw-code{
	cursor:pointer;
    position: absolute;
    top: -28px;
    right: 0;
    background-color: rgba(255, 255, 255, .8);
    padding: 2px 4px;
    border: 1px solid #263237;
    color: #263237;
}
.raw-code.hide{
	display:none;
}
.raw-code.show{
	display:inherit;
}
.typora-export p, .typora-export li {white-space: inherit;} 

</style>
 
</head>
<body class="typora-export">
<div class="typora-container">
  <div class="typora-menu"><div class="md-toc" mdtype="toc">
	<p class="md-toc-content"><span class='md-toc-item md-toc-h1'><a title ='7 Bases de datos' class="md-toc-inner active" style="cursor: pointer;" href="">7 Bases de datos</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-0' title='Crear la base de datos' class="md-toc-inner" style="cursor: pointer;" href="#crear-la-base-de-datos">Crear la base de datos</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-1' title='Trabajar con bases de datos' class="md-toc-inner" style="cursor: pointer;" href="#trabajar-con-bases-de-datos">Trabajar con bases de datos</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-2' title='Insertar datos a la antigua usanza' class="md-toc-inner" style="cursor: pointer;" href="#insertar-datos-a-la-antigua-usanza">Insertar datos a la antigua usanza</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-3' title='Evitar SQL Injection' class="md-toc-inner" style="cursor: pointer;" href="#evitar-sql-injection">Evitar SQL Injection</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-4' title='Mapeo entidad-relación' class="md-toc-inner" style="cursor: pointer;" href="#mapeo-entidad-relación">Mapeo entidad-relación</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-5' title='Crear un repositorio' class="md-toc-inner" style="cursor: pointer;" href="#crear-un-repositorio">Crear un repositorio</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-6' title='Inyección de dependencias' class="md-toc-inner" style="cursor: pointer;" href="#inyección-de-dependencias">Inyección de dependencias</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-7' title='Mostrar las imágenes de la base de datos' class="md-toc-inner" style="cursor: pointer;" href="#mostrar-las-imágenes-de-la-base-de-datos">Mostrar las imágenes de la base de datos</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-8' title='Reestructurar código (parte I)' class="md-toc-inner" style="cursor: pointer;" href="#reestructurar-código-parte-i">Reestructurar código (parte I)</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-9' title='Service Locator o Dependency Injection Containers' class="md-toc-inner" style="cursor: pointer;" href="#service-locator-o-dependency-injection-containers">Service Locator o Dependency Injection Containers</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-10' title='Reestructurar código (parte II)' class="md-toc-inner" style="cursor: pointer;" href="#reestructurar-código-parte-ii">Reestructurar código (parte II)</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-11' title='Crear repositorios' class="md-toc-inner" style="cursor: pointer;" href="#crear-repositorios">Crear repositorios</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-12' title='Relaciones' class="md-toc-inner" style="cursor: pointer;" href="#relaciones">Relaciones</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-13' title='Transacciones' class="md-toc-inner" style="cursor: pointer;" href="#transacciones">Transacciones</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-14' title='Ejemplo de uso' class="md-toc-inner" style="cursor: pointer;" href="#ejemplo-de-uso">Ejemplo de uso</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-15' title='Credits.' class="md-toc-inner" style="cursor: pointer;" href="#credits">Credits.</a></span>
</p></div></div>
  <div class="typora-export  main-content">
  <div class='top'>
    <a class='toogle expanded pull-left js-toolbar-action' aria-label='' href='#'><i class='fas fa-align-justify'></i></a>
    <a class='' href='#' id='nav-previous'><i class='fas fa-angle-double-left'></i></a>
    <a class='' href='#' id='nav-next'><i class='fas fa-angle-double-right'></i></a>
  </div>
    <div id='write-wrapper'>
      <div id='custom-header'>
        <!--put here your custom header -->
       </div>
       <div id="write" class="">
<h2 id="heading-0">
<a name="crear-la-base-de-datos" class="md-header-anchor"></a><span>Crear la base de datos</span>
</h2>
<p><span>Vamos a usar una base de datos, llamada </span><strong><span>proyecto1</span></strong></p>
<p><img src="assets/1541700940580.png" referrerpolicy="no-referrer" alt="1541700940580"></p>
<p><span>Y creamos un usuario para la base de datos que </span><strong><span>sólo tenga privilegios sobre datos</span></strong><span>:</span></p>
<video src="assets/usuario.m4v" controls="controls"></video><p><span>Crear la tabla </span><strong><span>imagenes</span></strong></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> `imagenes` (</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `id` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `nombre` <span class="cm-builtin">varchar</span>(<span class="cm-number">255</span>) COLLATE utf8_spanish_ci <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `descripcion` <span class="cm-builtin">text</span> COLLATE utf8_spanish_ci,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `numVisualizaciones` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> DEFAULT <span class="cm-string">'0'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `numLikes` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> DEFAULT <span class="cm-string">'0'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `numDownloads` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> DEFAULT <span class="cm-string">'0'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `imagenes`</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ADD PRIMARY KEY (`id`),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ADD UNIQUE KEY `nombre` (`nombre`);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `imagenes`</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  MODIFY `id` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> AUTO_INCREMENT;</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 346px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 346px;"></div>
</div>
</div></pre>
<h2 id="heading-1">
<a name="trabajar-con-bases-de-datos" class="md-header-anchor"></a><span>Trabajar con bases de datos</span>
</h2>
<p><strong><span>Crear la conexión</span></strong></p>
<p><span>Crear la clase </span><code>Connection</code><span> dentro de la carpeta </span><code>database</code><span>:</span></p>
<p><img src="assets/1542133041588.png" referrerpolicy="no-referrer" alt="1542133041588"></p>
<h3 id="heading-2">
<a name="insertar-datos-a-la-antigua-usanza" class="md-header-anchor"></a><span>Insertar datos a la antigua usanza</span>
</h3>
<p><span>En </span><code>galeria.php</code></p>
<p><img src="assets/1542013991946.png" referrerpolicy="no-referrer" alt="1542013991946"></p>
<p><span>Pero esta forma de realizar las modificaciones en la base de datos tiene un serio problema ya que permite a un atacante realizar un ataque de </span><a href="https://www.w3schools.com/sql/sql_injection.asp"><span>inyección de SQL</span></a><span> que es una de los principales técnicas para atacar la base de datos.</span></p>
<p><span>Según la </span><a href="https://en.wikipedia.org/wiki/SQL_injection"><span>Wikipedia</span></a><span>,</span></p>
<blockquote>
<p><strong><span>SQL injection</span></strong><span>  is a </span><a href="https://en.wikipedia.org/wiki/Code_injection"><span>code injection</span></a><span> technique, used  to </span><a href="https://en.wikipedia.org/wiki/Attack_(computing)"><span>attack</span></a><span> data-driven applications, in which malicious </span><a href="https://en.wikipedia.org/wiki/SQL"><span>SQL</span></a><span> statements are inserted into an entry field for execution (e.g. to dump the database contents to the attacker).[</span><a href="https://en.wikipedia.org/wiki/SQL_injection#cite_note-1"><span>1</span><span>]</span></a><span> SQL injection must exploit a </span><a href="https://en.wikipedia.org/wiki/Security_vulnerability"><span>security vulnerability</span></a><span> in an application's software, for example, when user input is either incorrectly filtered for </span><a href="https://en.wikipedia.org/wiki/String_literal"><span>string literal</span></a><span> </span><a href="https://en.wikipedia.org/wiki/Escape_sequence"><span>escape characters</span></a><span> embedded in SQL statements or user input is not </span><a href="https://en.wikipedia.org/wiki/Strongly-typed_programming_language"><span>strongly typed</span></a><span> and unexpectedly executed. SQL injection is mostly known as an attack </span><a href="https://en.wikipedia.org/wiki/Vector_(malware)"><span>vector</span></a><span> for websites but can be used to attack any type of SQL database. </span></p>
<p><span>SQL injection attacks allow attackers to spoof identity, tamper  with existing data, cause repudiation issues such as voiding  transactions or changing balances, allow the complete disclosure of all  data on the system, destroy the data or make it otherwise unavailable,  and become administrators of the database server. </span></p>
<p><span>In a 2012 study, it was observed that the average web application  received 4 attack campaigns per month, and retailers received twice as  many attacks as other industries.[</span><a href="https://en.wikipedia.org/wiki/SQL_injection#cite_note-2"><span>2</span><span>]</span></a><span> </span></p>
</blockquote>
<p><span>Por ejemplo supón que alguien introduce la siguiente descripción:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99731px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Mensaje<span class="cm-string">');delete from imagenes where ('</span><span class="cm-number">1</span><span class="cm-string">' = '</span><span class="cm-number">1</span></span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Lo que va a ocurrir es que cuando creemos la cadena </span><code>$sql</code><span>, esta sea la siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99731px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"INSERT INTO imagenes (nombre, descripcion) VALUES ('1541703793_e1.png', 'Mensaje');delete from imagenes where ('1' = '1')"</span></span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 53px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 53px;"></div>
</div>
</div></pre>
<p><span>Y esto va a provocar que se </span><strong><span>borre toda la tabla de imágenes</span></strong><span> (o que haga un drop, ...)</span></p>
<h3 id="heading-3">
<a name="evitar-sql-injection" class="md-header-anchor"></a><span>Evitar SQL Injection</span>
</h3>
<p><span>Para evitar este tipo de ataques se deben utilizar </span><strong><span>Prepared Statements</span></strong><span> donde se usan marcadores de posición:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99731px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$sql</span> <span class="cm-operator">=</span> <span class="cm-string">"INSERT INTO imagenes (nombre, descripcion) VALUES (:nombre, :descripcion)"</span>;</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Que luego se fijan con </span><code>$connection-&gt;bindValue()</code><span>,  antes de llamar a </span><code>exec()</code><span> se debe llamar a </span><code>prepare()</code><span>. Por ejemplo:</span></p>
<p><img src="assets/1542014028836.png" referrerpolicy="no-referrer" alt="1542014028836"></p>
<blockquote><p><strong><span>Cuidado</span></strong><span>. Cuando queremos usar el valor devuelto por una </span><strong><span>función</span></strong><span> (y </span><code>$file-&gt;getFileName()</code><span> lo es), hemos de usar </span><code>bindValue</code><span>. Si por el contrario es una </span><strong><span>variable</span></strong><span> normal podemos usar </span><code>bindParam</code><span>.</span></p></blockquote>
<p><span>También se puede usar </span><em><span>?</span></em><span> para marcar la posición:</span></p>
<p><img src="assets/1542014055233.png" referrerpolicy="no-referrer" alt="1542014055233"></p>
<p><span>Pero lo más adecuado es crear un array con los parámetros y pasárselo a </span><code>execute()</code><span>:</span></p>
<p><img src="assets/1542014069715.png" referrerpolicy="no-referrer" alt="1542014069715"></p>
<h2 id="heading-4">
<a name="mapeo-entidad-relaci%C3%B3n" class="md-header-anchor"></a><span>Mapeo entidad-relación</span>
</h2>
<p><span>Vamos a usar la capacidad (</span><em><span>limitada</span></em><span>) de autogenerar objetos desde una consulta que nos ofrece PDO. Es muy sencillo: sólo hemos de llamar a uno de los métodos de PDO e indicarle que queremos obtener objetos (no registros) de una clase concreta:</span></p>
<p><span>Por ejemplo,</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99756px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$pdoStatement</span><span class="cm-operator">-&gt;</span><span class="cm-variable">fetchAll</span>(<span class="cm-variable">\PDO</span>::<span class="cm-variable">FETCH_CLASS</span> <span class="cm-operator">|</span> <span class="cm-variable">\PDO</span>::<span class="cm-variable">FETCH_PROPS_LATE</span>, <span class="cm-string">'ImagenGaleria)</span></span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>devolvería un array de objetos con todas las imágenes de la galería.</span></p>
<p><span>Pero antes de usarlo hemos de modificar un poco la clase </span><code>ImagenGaleria</code><span>, ya que hace falta crear el atributo </span><strong><span>id</span></strong><span>, y modificar el constructor para que todos los atributos tengan un valor por defecto. Así que en </span><code>ImagenGaleria.php</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99756px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* @var int</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-2">$id</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// .....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$nombre</span> <span class="cm-operator">=</span> <span class="cm-string">''</span>, <span class="cm-variable">string</span> <span class="cm-variable-2">$descripcion</span> <span class="cm-operator">=</span> <span class="cm-string">''</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                            <span class="cm-variable">int</span> <span class="cm-variable-2">$numVisualizaciones</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">int</span> <span class="cm-variable-2">$numLikes</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                            <span class="cm-variable">int</span> <span class="cm-variable-2">$numDownloads</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">nombre</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$nombre</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">descripcion</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$descripcion</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numVisualizaciones</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numVisualizaciones</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numLikes</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numLikes</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numDownloads</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numDownloads</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//.....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* @return int|null</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">getId</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">id</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* Set the value of id</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* @param  int  $id</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* @return  self</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*/</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">setId</span>(<span class="cm-variable">int</span> <span class="cm-variable-2">$id</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$id</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//....</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 953px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 953px;"></div>
</div>
</div></pre>
<h2 id="heading-5">
<a name="crear-un-repositorio" class="md-header-anchor"></a><span>Crear un repositorio</span>
</h2>
<p><span>Vamos a juntar todo el código referente a seleccionar entidades de la base de datos y a convertirlas en objetos en una clase llamada </span><code>QueryBuilder</code><span>, que estará ubicada dentro de la carpeta </span><code>database</code><span>.</span></p>
<h3 id="heading-6">
<a name="inyecci%C3%B3n-de-dependencias" class="md-header-anchor"></a><span>Inyección de dependencias</span>
</h3>
<p><span>En el constructor de la clase le pasaremos como argumento la conexión a la base de datos, usando inyección de dependencia (DI). </span></p>
<p><span>Según la </span><a href=""><span>Wikipedia</span></a><span>:</span></p>
<blockquote>
<p><span>In </span><a href="https://en.wikipedia.org/wiki/Software_engineering"><span>software engineering</span></a><span>, </span><strong><span>dependency injection</span></strong><span> is a technique whereby one object supplies the dependencies of another object. A dependency is an object that can be used (a </span><a href="https://en.wikipedia.org/wiki/Service_(systems_architecture)"><span>service</span></a><span>). An injection is the passing of a dependency to a dependent object (a </span><a href="https://en.wikipedia.org/wiki/Client_(computing)"><span>client</span></a><span>) that would use it. The service is made part of the client's </span><a href="https://en.wikipedia.org/wiki/State_(computer_science)"><span>state</span></a><span>.</span></p>
<p><span>The intent behind dependency injection is to </span><a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)"><span>decouple</span></a><span>  objects to the extent that no client code has to be changed simply  because an object it depends on needs to be changed to a different one.  Dependency injection is one form of the broader technique of </span><a href="https://en.wikipedia.org/wiki/Inversion_of_control"><span>inversion of control</span></a><span>. As with other forms of inversion of control, dependency injection supports the </span><a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle"><span>dependency inversion principle</span></a><span>.  The client delegates the responsibility of providing its dependencies  to external code (the injector). The client is not allowed to call the  injector code;it is the injecting code that constructs the services and calls the  client to inject them.  This means the client code does not need to know  about the injecting code, how to construct the services or even which  actual services it is using; the client only needs to know about the  intrinsic interfaces of the services because these define how the client  may use the services.  This separates the responsibilities of use and  construction. </span></p>
<p><span>There are three common means for a client to accept a dependency injection: </span><a href="https://en.wikipedia.org/wiki/Mutator_method"><span>setter</span></a><span>-, </span><a href="https://en.wikipedia.org/wiki/Interface_(object-oriented_programming)"><span>interface</span></a><span>- and </span><a href="https://en.wikipedia.org/wiki/Constructor_(object-oriented_programming)"><span>constructor</span></a><span>-based  injection. Setter and constructor injection differ mainly by when they  can be used.  Interface injection differs in that the dependency is  given a chance to control its own injection. Each requires that separate  construction code (the injector) takes responsibility for introducing a  client and its dependencies to each other.</span></p>
</blockquote>
<p><span>Además, la clase tiene un método </span><code>findAll</code><span> que nos devuelve todos los registros de la base de datos mapeados en objetos.</span></p>
<p><span>La clase sería de la siguiente forma:</span></p>
<p><img src="assets/image-20211115104053082.png" referrerpolicy="no-referrer" alt="image-20211115104053082"></p>
<p><span>En el </span><strong><span>constructor le pasamos la dependencia</span></strong><span>, de tal forma que esta clase está </span><strong><span>desacoplada</span></strong><span> de la conexión.</span></p>
<p><span>Si no seguimos el patrón de inyección de dependencia, la clase </span><code>QueryBuilder</code><span> sería de la siguiente forma:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99756px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../exceptions/QueryException.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-string">"./database/Connection.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">QueryBuilder</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var PDO</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$connection</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">connection</span> <span class="cm-operator">=</span>  <span class="cm-variable">Connection</span>::<span class="cm-variable">make</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">findAll</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$table</span>, <span class="cm-variable">string</span> <span class="cm-variable-2">$classEntity</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// El mismo que antes</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} </span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 413px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 413px;"></div>
</div>
</div></pre>
<p><span>Es decir, esta clase está totalmente acoplada de la clase </span><code>Connection</code><span>. Y, ¿qué ocurre si después cambiamos la definición de la clase </span><code>Connection</code><span> o creamos por ejemplo una conexión que guarde los datos en disco con un método distinto para realizar la conexión?. Pues que habría que modificar la clase </span><code>QueryBuilder</code><span>, simplemente porque hemos cambiado una clase de la que depende estrechamente.</span></p>
<p><span>Según la Wikipedia, el </span><a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)"><span>acoplamiento</span></a><span>,</span></p>
<blockquote>
<p><span>In </span><a href="https://en.wikipedia.org/wiki/Software_engineering"><span>software engineering</span></a><span>, </span><strong><span>coupling</span></strong><span> is the degree of interdependence between software modules; a measure of how closely connected two routines or modules are; the strength of the relationships between modules.</span></p>
<p><span>Coupling is usually contrasted with </span><a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)"><span>cohesion</span></a><span>. </span><a href="https://en.wikipedia.org/wiki/Loose_coupling"><span>Low coupling</span></a><span> often correlates with high cohesion, and vice versa. Low coupling is often a sign of a well-structured </span><a href="https://en.wikipedia.org/wiki/Computer"><span>computer system</span></a><span> and a good design, and when combined with high cohesion, supports the general goals of high readability and maintainability</span></p>
</blockquote>
<p><span>Y la </span><a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)"><span>cohesión</span></a><span>,</span></p>
<blockquote>
<p><span>In </span><a href="https://en.wikipedia.org/wiki/Computer_programming"><span>computer programming</span></a><span>, </span><strong><span>cohesion</span></strong><span> refers to the </span><em><span>degree to which the elements inside a module belong together</span></em><span>. In one sense, it is a measure of the strength of relationship between  the methods and data of a class and some unifying purpose or concept  served by that class. In another sense, it is a measure of the strength  of relationship between the class’s methods and data themselves. </span></p>
<p><span>Cohesion is an </span><a href="https://en.wikipedia.org/wiki/Level_of_measurement#Ordinal_scale"><span>ordinal</span></a><span>  type of measurement and is usually described as “high cohesion” or “low  cohesion”. Modules with high cohesion tend to be preferable, because  high cohesion is associated with several desirable traits of software  including </span><a href="https://en.wikipedia.org/wiki/Robustness_(computer_science)"><span>robustness</span></a><span>, reliability, </span><a href="https://en.wikipedia.org/wiki/Reusability"><span>reusability</span></a><span>,  and understandability. In contrast, low cohesion is associated with  undesirable traits such as being difficult to maintain, test, reuse, or  even understand. </span></p>
<p><span>Cohesion is often contrasted with </span><a href="https://en.wikipedia.org/wiki/Coupling_(computer_science)"><span>coupling</span></a><span>, a different concept. High cohesion often correlates with </span><a href="https://en.wikipedia.org/wiki/Loose_coupling"><span>loose coupling</span></a><span>, and vice versa.The </span><a href="https://en.wikipedia.org/wiki/Software_metric"><span>software metrics</span></a><span> of coupling and cohesion were invented by </span><a href="https://en.wikipedia.org/wiki/Larry_Constantine"><span>Larry Constantine</span></a><span> in the late 1960s as part of </span><a href="https://en.wikipedia.org/wiki/Structured_Design"><span>Structured Design</span></a><span>,  based on characteristics of “good” programming practices that reduced  maintenance and modification costs. Structured Design, cohesion and  coupling were published in the article </span><a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)#CITEREFStevensMyersConstantine1974"><span>Stevens, Myers &amp; Constantine (1974)</span></a><span> and the book </span><a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)#CITEREFYourdonConstantine1979"><span>Yourdon &amp; Constantine (1979)</span></a><span>; the latter two subsequently became standard terms in software engineering. </span></p>
</blockquote>
<p><span>En el desarrollo de software se busca siempre </span><strong><span>una alta cohesión y un bajo acoplamiento</span></strong><span>.</span></p>
<p><span>Una forma de conseguir lo segundo es mediante el uso de </span><strong><span>DI</span></strong><span>.</span></p>
<p><span>De hecho ya lo hemos usado en las clases </span><code>Validator</code><span>, aunque allí la inyección la hemos hecho con setters (</span><code>setValidador</code><span> y </span><code>appendValidator</code><span>) que es otra de las formas para inyectar una dependencia. </span></p>
<p><span>Se puede hacer DI con un setter cuando esta dependencia no es crucial para el objeto. En el caso del </span><code>Validator</code><span>, las clases que derivan de </span><code>DataElement</code><span> </span><strong><span>pueden funcionar</span></strong><span> sin </span><code>Validator</code><span>, es por ello que se puede usar la inyección por setter. Pero la clase </span><code>QueryBuilder</code><span> </span><strong><span>no puede funcionar</span></strong><span>  sin una conexión y, por tanto, se inyecta en el constructor.</span></p>
<p><span>Como podéis observar, cuando la consulta no funciona, lanza una excepción de tipo </span><code>QueryException</code><span> que hemos de crear también en la carpeta </span><code>exceptions</code><span>.</span></p>
<p><span>De momento esta excepción simplemente hereda de la clase </span><code>Exception</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">QueryException</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Exception</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$message</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">parent</span>::<span class="cm-variable">__construct</span>(<span class="cm-variable-2">$message</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Vamos a hacer una prueba:</span></p>
<p><img src="assets/1542014241990.png" referrerpolicy="no-referrer" alt="1542014241990"></p>
<h2 id="heading-7">
<a name="mostrar-las-im%C3%A1genes-de-la-base-de-datos" class="md-header-anchor"></a><span>Mostrar las imágenes de la base de datos</span>
</h2>
<p><span>Ahora es muy sencillo seleccionar registros:</span></p>
<p><img src="assets/image-20191120192017057.png" referrerpolicy="no-referrer" alt="image-20191120192017057"></p>
<p><span>Y vamos a modificar </span><code>galeria.view.php</code><span> para mostrar una tabla con todos los registros:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//.....</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?=</span><span class="cm-variable-2">$form</span><span class="cm-operator">-&gt;</span><span class="cm-variable">render</span>();<span class="cm-operator">?&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">hr</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">"divider"</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">div</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">"imagenes_galeria"</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-operator">&lt;</span><span class="cm-variable">table</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">"table"</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;</span><span class="cm-variable">thead</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;</span><span class="cm-variable">tr</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;</span><span class="cm-variable">th</span> <span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">"col"</span><span class="cm-operator">&gt;</span><span class="cm-comment">#&lt;/th&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;</span><span class="cm-variable">th</span> <span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">"col"</span><span class="cm-operator">&gt;</span><span class="cm-variable">Imagen</span><span class="cm-operator">&lt;/</span><span class="cm-variable">th</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;</span><span class="cm-variable">th</span> <span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">"col"</span><span class="cm-operator">&gt;</span><span class="cm-variable">Visualizaciones</span><span class="cm-operator">&lt;/</span><span class="cm-variable">th</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;</span><span class="cm-variable">th</span> <span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">"col"</span><span class="cm-operator">&gt;</span><span class="cm-variable">Likes</span><span class="cm-operator">&lt;/</span><span class="cm-variable">th</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;</span><span class="cm-variable">th</span> <span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">"col"</span><span class="cm-operator">&gt;</span><span class="cm-variable">Descargas</span><span class="cm-operator">&lt;/</span><span class="cm-variable">th</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;/</span><span class="cm-variable">tr</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;/</span><span class="cm-variable">thead</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;</span><span class="cm-variable">tbody</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;?</span><span class="cm-variable">php</span> <span class="cm-keyword">foreach</span> (<span class="cm-variable-2">$imagenes</span> <span class="cm-keyword">as</span> <span class="cm-variable-2">$imagen</span>): <span class="cm-operator">?&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;</span><span class="cm-variable">tr</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-operator">&lt;</span><span class="cm-variable">th</span> <span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">"row"</span><span class="cm-operator">&gt;&lt;?=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>(); <span class="cm-operator">?&gt;&lt;/</span><span class="cm-variable">th</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-operator">&lt;</span><span class="cm-variable">td</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                    <span class="cm-operator">&lt;</span><span class="cm-variable">img</span> <span class="cm-variable">src</span><span class="cm-operator">=</span><span class="cm-string">"&lt;?= </span><span class="cm-variable-2">$imagen</span>-&gt;<span class="cm-variable">getUrlGallery</span><span class="cm-string">(); ?&gt;"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                         <span class="cm-variable">alt</span><span class="cm-operator">=</span><span class="cm-string">"&lt;?= </span><span class="cm-variable-2">$imagen</span>-&gt;<span class="cm-variable">getDescripcion</span><span class="cm-string">(); ?&gt;"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                         <span class="cm-variable">title</span><span class="cm-operator">=</span><span class="cm-string">"&lt;?= </span><span class="cm-variable-2">$imagen</span>-&gt;<span class="cm-variable">getDescripcion</span><span class="cm-string">(); ?&gt;"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                         <span class="cm-variable">width</span><span class="cm-operator">=</span><span class="cm-string">"100px"</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-operator">&lt;/</span><span class="cm-variable">td</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-operator">&lt;</span><span class="cm-variable">td</span><span class="cm-operator">&gt;&lt;?=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumVisualizaciones</span>(); <span class="cm-operator">?&gt;&lt;/</span><span class="cm-variable">td</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-operator">&lt;</span><span class="cm-variable">td</span><span class="cm-operator">&gt;&lt;?=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumLikes</span>(); <span class="cm-operator">?&gt;&lt;/</span><span class="cm-variable">td</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-operator">&lt;</span><span class="cm-variable">td</span><span class="cm-operator">&gt;&lt;?=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumDownloads</span>(); <span class="cm-operator">?&gt;&lt;/</span><span class="cm-variable">td</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-operator">&lt;/</span><span class="cm-variable">tr</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;?</span><span class="cm-variable">php</span> <span class="cm-keyword">endforeach</span>; <span class="cm-operator">?&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-operator">&lt;/</span><span class="cm-variable">tbody</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-operator">&lt;/</span><span class="cm-variable">table</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;/</span><span class="cm-variable">div</span><span class="cm-operator">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 728px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 728px;"></div>
</div>
</div></pre>
<p><span>Y este es el resultado:</span></p>
<p><img src="assets/1542041292987.png" referrerpolicy="no-referrer" alt="1542041292987"></p>
<h2 id="heading-8">
<a name="reestructurar-c%C3%B3digo-parte-i" class="md-header-anchor"></a><span>Reestructurar código (parte I)</span>
</h2>
<p><span>Vamos a refactorizar la clase </span><code>Connection</code><span> para que no esté harcodeada la conexión a la base de datos. Generalmente se suele usar un archivo de configuración con todos los datos relativos a la configuración de la aplicación en un script aparte, de tal forma que se pueden tener varias versiones del mismo dependiendo de si el entorno es desarrollo, producción, test, etc.</span></p>
<p><span>Este archivo de configuración se llamará </span><code>config.php</code><span> y estará en la carpeta </span><strong><span>app</span></strong><span>. De momento, constará de los datos necesarios para conectar con la base de datos.</span></p>
<p><img src="assets/1542133113182.png" referrerpolicy="no-referrer" alt="1542133113182"></p>
<blockquote>
<p><strong><span>IMPORTANTE</span></strong>
<span>El archivo </span><code>config.php</code><span> </span><strong><span>no debe subirse al repositorio</span></strong><span> ya que tiene los datos reales de la conexión.</span>
<span>En su lugar, subiremos un archivo </span><code>config-sample.php</code><span> donde no aparecerán los datos relevantes.</span></p>
<p><span>Por ejemplo:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> [</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-string">'database'</span> <span class="cm-operator">=&gt;</span> [</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-string">'name'</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">'nombre-de-la-base-de-datos'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-string">'username'</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">'usuario'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-string">'password'</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">'contraseña'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-string">'connection'</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">'mysql:host=localhost'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-string">'options'</span> <span class="cm-operator">=&gt;</span> [</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         <span class="cm-variable">PDO</span>::<span class="cm-variable">MYSQL_ATTR_INIT_COMMAND</span><span class="cm-operator">=&gt;</span> <span class="cm-string">'SET NAMES utf8'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         <span class="cm-variable">PDO</span>::<span class="cm-variable">ATTR_ERRMODE</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">PDO</span>::<span class="cm-variable">ERRMODE_EXCEPTION</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         <span class="cm-variable">PDO</span>::<span class="cm-variable">ATTR_PERSISTENT</span> <span class="cm-operator">=&gt;</span> <span class="cm-atom">true</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     ]</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ]</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">];</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 323px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 323px;"></div>
</div>
</div></pre>
<p><span>Cada cambio realizado en </span><code>config.php</code><span> también debe reflejarse en </span><code>config-sample.php</code></p>
</blockquote>
<p><span>Modificamos la clase </span><code>Connection</code><span> para que reciba esta configuración en el constructor:</span></p>
<p><img src="assets/1542133141195.png" referrerpolicy="no-referrer" alt="1542133141195"></p>
<p><span>Y ahora es tan sencillo como asignar este array a una variable que almacene la configuración. Por ejemplo,</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//galeria.php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// ....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$config</span> <span class="cm-operator">=</span> <span class="cm-keyword">require_once</span> <span class="cm-string">'app/config.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$connection</span> <span class="cm-operator">=</span> <span class="cm-variable">Connection</span>::<span class="cm-variable">make</span>(<span class="cm-variable-2">$config</span>[<span class="cm-string">'database'</span>]);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-string">"POST"</span> <span class="cm-operator">===</span> <span class="cm-variable-2">$_SERVER</span>[<span class="cm-string">"REQUEST_METHOD"</span>]) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-comment">// .... </span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 166px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 166px;"></div>
</div>
</div></pre>
<h2 id="heading-9">
<a name="service-locator-o-dependency-injection-containers" class="md-header-anchor"></a><span>Service Locator o Dependency Injection Containers</span>
</h2>
<p><span>Este es otro patrón de desarrollo de software que se usa para encapsular servicios (entendiendo un servicio como cualquier objeto que se pueda necesitar en toda la aplicación) en un contenedor centralizado. Generalmente es usado junto con DI.</span></p>
<p><span>Según la </span><a href="https://en.wikipedia.org/wiki/Service_locator_pattern"><span>Wikipedia</span></a><span>:</span></p>
<blockquote><p><span>The </span><strong><span>service locator pattern</span></strong><span> is a </span><a href="https://en.wikipedia.org/wiki/Design_pattern_(computer_science)"><span>design pattern</span></a><span> used in </span><a href="https://en.wikipedia.org/wiki/Software_development"><span>software development</span></a><span> to encapsulate the processes involved in obtaining a service with a strong </span><a href="https://en.wikipedia.org/wiki/Abstraction_layer"><span>abstraction layer</span></a><span>. This pattern uses a central registry known as the "service locator",  which on request returns the information necessary to perform a certain task. The main criticism of service location is that it obscures dependencies.</span>
<span>Meanwhile, its proponents say the approach should not be discarded as it simplifies component-based applications where all dependencies are cleanly listed at the beginning of the whole application design, </span>
<span>consequently making traditional dependency injection a more complex way of connecting objects. The usual criticism of service locator pattern as being the one which is "much harder to test" actually becomes a benefit in such applications.</span></p></blockquote>
<p><strong><span>Vamos a verlo con un ejemplo.</span></strong></p>
<p><span>Se trata de guardar los objetos necesarios para la aplicación en un contenedor, de tal forma que podemos guardarlos y recuperarlos cada vez que sea necesario, sin tener que crear nuevos objetos.</span></p>
<p><span>Lo creamos dentro carpeta </span><code>core</code><span> con el nombre </span><code>App.php</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-string">'./exceptions/AppException.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">App</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var array</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-variable-2">$container</span> <span class="cm-operator">=</span> [];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @param string $key</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @param $value</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-def">bind</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$key</span>, <span class="cm-variable-2">$value</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">self</span>::<span class="cm-variable-2">$container</span>[<span class="cm-variable-2">$key</span>] <span class="cm-operator">=</span> <span class="cm-variable-2">$value</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @param string $key</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @return mixed</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @throws AppException</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-def">get</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$key</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-builtin">array_key_exists</span>(<span class="cm-variable-2">$key</span>, <span class="cm-keyword">static</span>::<span class="cm-variable-2">$container</span>)){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">AppException</span>(<span class="cm-string">"No se ha encontrado la clave </span><span class="cm-variable-2">$key</span> <span class="cm-string">en el contenedor"</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> <span class="cm-keyword">self</span>::<span class="cm-variable-2">$container</span>[<span class="cm-variable-2">$key</span>];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 773px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 773px;"></div>
</div>
</div></pre>
<p><span>Vamos a crear la excepción </span><code>AppException</code><span>, dentro de la carpeta </span><code>exceptions</code><span>.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">AppException</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Exception</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$message</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">parent</span>::<span class="cm-variable">__construct</span>(<span class="cm-variable-2">$message</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 166px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 166px;"></div>
</div>
</div></pre>
<p><span>Y modificamos la clase </span><code>Connection</code><span>, para que use este contenedor:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../core/App.php'</span>;</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-keyword">function</span> <span class="cm-def">make</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">try</span>{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             <span class="cm-variable-2">$config</span> <span class="cm-operator">=</span> <span class="cm-variable">App</span>::<span class="cm-variable">get</span>(<span class="cm-string">'config'</span>)[<span class="cm-string">'database'</span>];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-comment">//resto de código</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 166px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 166px;"></div>
</div>
</div></pre>
<p><span>En </span><code>QueryBuilder</code><span>, modificamos el constructor:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>()</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">connection</span> <span class="cm-operator">=</span>  <span class="cm-variable">App</span>::<span class="cm-variable">get</span>(<span class="cm-string">'connection'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 98px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 98px;"></div>
</div>
</div></pre>
<p><span>Y ahora en el inicio de cada controlador, hemos de rellenar el contenedor de servicios con la configuración y la conexión:</span></p>
<p><img src="assets/image-20191120194046882.png" referrerpolicy="no-referrer" alt="image-20191120194046882"></p>
<p><span>Como hemos visto en </span><code>QueryBuilder</code><span> para acceder a la conexión, simplemente hemos de utilizar el contenedor de dependencias:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">App</span>::<span class="cm-variable">get</span>(<span class="cm-string">'connection'</span>)</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>De esta forma ya no hace falta inyectar la dependencia manualmente en cada clase. De hecho hay frameworks como </span><strong><span>Symfony</span></strong><span> que inyectan dependencias automáticamente simplemente pasándoles un parámetro al constructor, que debe estar determinado con </span><strong><span>type hint</span></strong><span> (ya lo veremos más adelante). Lo importante aquí es que os quedéis con el concepto de Contenedores de Dependencias.</span></p>
<h2 id="heading-10">
<a name="reestructurar-c%C3%B3digo-parte-ii" class="md-header-anchor"></a><span>Reestructurar código (parte II)</span>
</h2>
<p><span>Refactorizamos la clase </span><code>QueryBuilder</code><span> porque en el constructor deberíamos pasarle tanto la tabla como la entidad:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../exceptions/QueryException.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> .<span class="cm-string">"/Connection.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../core/App.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">QueryBuilder</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$connection</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var string</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$table</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var string</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$classEntity</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$table</span>, <span class="cm-variable">string</span> <span class="cm-variable-2">$classEntity</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">connection</span> <span class="cm-operator">=</span>  <span class="cm-variable">App</span>::<span class="cm-variable">get</span>(<span class="cm-string">'connection'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">table</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$table</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">classEntity</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$classEntity</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">findAll</span>(){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$sql</span> <span class="cm-operator">=</span> <span class="cm-string">"SELECT * FROM </span><span class="cm-variable-2">$this</span>-&gt;<span class="cm-variable">table</span><span class="cm-string">"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">try</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable-2">$pdoStatement</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">connection</span><span class="cm-operator">-&gt;</span><span class="cm-variable">prepare</span>(<span class="cm-variable-2">$sql</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable-2">$pdoStatement</span><span class="cm-operator">-&gt;</span><span class="cm-variable">execute</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable-2">$pdoStatement</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setFetchMode</span>(<span class="cm-variable">PDO</span>::<span class="cm-variable">FETCH_CLASS</span> <span class="cm-operator">|</span> <span class="cm-variable">PDO</span>::<span class="cm-variable">FETCH_PROPS_LATE</span>, <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">classEntity</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-variable-2">$pdoStatement</span><span class="cm-operator">-&gt;</span><span class="cm-variable">fetchAll</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }<span class="cm-keyword">catch</span>(<span class="cm-variable">\PDOException</span> <span class="cm-variable-2">$pdoException</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">QueryException</span>(<span class="cm-string">'No se ha podido ejecutar la consulta solicitada: '</span> . <span class="cm-variable-2">$pdoException</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getMessage</span>());</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} </span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 908px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 908px;"></div>
</div>
</div></pre>
<p><span>Además vamos a hacer que esta clase sea genérica y que nos permita hacer actualizaciones y modificaciones de cualquier entidad de nuestra base de datos. Todas las entidades deben implementar un método llamado </span><code>toArray</code><span> que va a ser particular para cada entidad. Tenemos dos opciones para implementar este comportamiento:</span></p>
<ol start="">
<li>
<span>Como las entidades no extienden ninguna clase, podemos hacer una clase </span><strong><span>abstracta</span></strong><span> </span><code>Entity</code><span> con un método también abstracto llamado </span><code>toArray()</code><span>. Si por el contrario estas dos clases extendieran clases distintas, la única opción sería crear un interfaz</span>
</li>
<li><span>O crear una interfaz, que declare este método.</span></li>
</ol>
<p><span>Vamos a optar por la opción 1, creando la clase </span><code>Entity</code><span> en el directorio </span><code>entity</code><span> y haciendo que todas las entidades extiendan a esta:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">Entity</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-keyword">function</span> <span class="cm-def">toArray</span>():<span class="cm-keyword">array</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 143px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 143px;"></div>
</div>
</div></pre>
<p><span>Este método convertirá  nuestra entidad en un array asociativo que luego usaremos en el </span><code>QueryBuider</code><span>.</span></p>
<p><span>Por ejemplo, en la clase </span><code>ImagenGaleria</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> .<span class="cm-string">'/Entity.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ImagenGaleria</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Entity</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//...</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">toArray</span>(): <span class="cm-keyword">array</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> [</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string">'id'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string">'nombre'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNombre</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string">'descripcion'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getDescripcion</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string">'numVisualizaciones'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumVisualizaciones</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string">'numLikes'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumLikes</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string">'numDownloads'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumDownloads</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    ];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 391px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 391px;"></div>
</div>
</div></pre>
<p><span>Y creamos un método </span><code>save</code><span> en </span><code>QueryBuilder</code><span> que permita hacer un </span><strong><span>insert</span></strong><span> de cualquier entidad:</span></p>
<p><img src="assets/1566841162182.png" referrerpolicy="no-referrer" alt="1566841162182"></p>
<p><span>Y ahora modificamos </span><code>galeria.php</code><span> para llamar a este método:</span></p>
<p><img src="assets/image-20191120194444433.png" referrerpolicy="no-referrer" alt="image-20191120194444433"></p>
<h3 id="heading-11">
<a name="crear-repositorios" class="md-header-anchor"></a><span>Crear repositorios</span>
</h3>
<p><span>En general, para cada entidad se deben crear repositorios que son clases que encapsulan tanto la creación y modificación de entidades como todas las consultas relacionadas con ellas.</span></p>
<p><span>Para ello, primero modificamos la clase </span><code>QueryBuilder</code><span> para que sea abstracta de tal forma que no se pueda instanciar.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">QueryBuilder</span></span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Y luego creamos tantos repositorios como entidades tenga nuestra aplicación. Estos repositorios los guardaremos dentro de la carpeta </span><code>repository</code><span>.</span></p>
<p><span>Por ejemplo, vamos a crear </span><code>ImagenGaleriaRepository</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../entity/ImagenGaleria.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../database/QueryBuilder.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ImagenGaleriaRepository</span> <span class="cm-keyword">extends</span> <span class="cm-variable">QueryBuilder</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">parent</span>::<span class="cm-variable">__construct</span>(<span class="cm-string">'imagenes'</span>, <span class="cm-string">'ImagenGaleria'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 212px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 212px;"></div>
</div>
</div></pre>
<p><span>Y ahora vamos a usarlo en </span><code>galeria.php</code></p>
<p><img src="assets/1542133307011.png" referrerpolicy="no-referrer" alt="1542133307011"></p>
<h2 id="heading-12">
<a name="relaciones" class="md-header-anchor"></a><span>Relaciones</span>
</h2>
<p><span>Vamos a crear una relación entre imágenes y categorías.</span></p>
<p><span>Para ello creamos la tabla </span><strong><span>categorias</span></strong><span>.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> `categorias` (</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `id` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `nombre` <span class="cm-builtin">varchar</span>(<span class="cm-number">255</span>) COLLATE utf8_spanish_ci <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `numImagenes` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> DEFAULT <span class="cm-string">'0'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `categorias`</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ADD PRIMARY KEY (`id`);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> `categorias` (`id`, `nombre`, `numImagenes`) <span class="cm-keyword">VALUES</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">1</span>, <span class="cm-string">'Categoría I'</span>, <span class="cm-number">20</span>),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">2</span>, <span class="cm-string">'Categoría II'</span>, <span class="cm-number">2</span>),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">3</span>, <span class="cm-string">'Categoría III'</span>, <span class="cm-number">2</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `categorias`</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  MODIFY `id` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> AUTO_INCREMENT, AUTO_INCREMENT=<span class="cm-number">4</span>;</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 368px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 368px;"></div>
</div>
</div></pre>
<p><span>Y a continuación creamos la clave ajena en la tabla </span><strong><span>imagenes</span></strong><span>, borrando previamente todas las filas para que no nos dé problemas de integridad referencial:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TRUNCATE <span class="cm-keyword">TABLE</span> `imagenes`;</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `imagenes` ADD  `categoria` <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `imagenes`</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ADD KEY `FK_CATEGORIA_IMAGEN` (`categoria`);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ALTER</span> <span class="cm-keyword">TABLE</span> `imagenes`</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ADD CONSTRAINT `FK_CATEGORIA_IMAGEN` FOREIGN KEY (`categoria`) REFERENCES `categorias` (`id`);</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 233px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 233px;"></div>
</div>
</div></pre>
<p><span>Y ahora creamos la entidad </span><code>Categoria</code><span> dentro de la carpeta </span><code>entity</code><span>.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> .<span class="cm-string">'/Entity.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Categoria</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Entity</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var int</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$id</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var string</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$nombre</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var int</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$numImagenes</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$nombre</span> <span class="cm-operator">=</span> <span class="cm-string">''</span>, <span class="cm-variable">int</span> <span class="cm-variable-2">$numImagenes</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">parent</span>::<span class="cm-variable">__construct</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">nombre</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$nombre</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numImagenes</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numImagenes</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//Setters y getters</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// .....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">toArray</span>(): <span class="cm-keyword">array</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> [</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'id'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'nombre'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNombre</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'numImagenes'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumImagenes</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        ];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 863px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 863px;"></div>
</div>
</div></pre>
<p><span>Y ahora modificamos la clase </span><code>ImagenGaleria</code><span> para que tenga un nuevo atributo llamado </span><code>categoria</code><span> con su setter y getter:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// ....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @var int</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">private</span> <span class="cm-variable-2">$categoria</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$nombre</span> <span class="cm-operator">=</span> <span class="cm-string">''</span>, <span class="cm-variable">string</span> <span class="cm-variable-2">$descripcion</span> <span class="cm-operator">=</span> <span class="cm-string">''</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                                <span class="cm-variable">int</span> <span class="cm-variable-2">$numVisualizaciones</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">int</span> <span class="cm-variable-2">$numLikes</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                                <span class="cm-variable">int</span> <span class="cm-variable-2">$numDownloads</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">int</span> <span class="cm-variable-2">$categoria</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">nombre</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$nombre</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">descripcion</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$descripcion</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numVisualizaciones</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numVisualizaciones</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numLikes</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numLikes</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">numDownloads</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$numDownloads</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">categoria</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$categoria</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//....</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* Get the value of categoria</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @return  int</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">getCategoria</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">categoria</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">/**</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* Set the value of categoria</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @param  int  $categoria</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">* @return  self</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     <span class="cm-comment">*/</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">setCategoria</span>(<span class="cm-variable">int</span> <span class="cm-variable-2">$categoria</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">categoria</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$categoria</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">toArray</span>(): <span class="cm-keyword">array</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> [</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'id'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'nombre'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNombre</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'descripcion'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getDescripcion</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'numVisualizaciones'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumVisualizaciones</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'numLikes'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumLikes</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'numDownloads'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumDownloads</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'categoria'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getCategoria</span>()</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        ];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1291px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 1291px;"></div>
</div>
</div></pre>
<p><span>Creamos el repositorio para las categorías, </span><code>CategoriaRepository</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../entity/Categoria.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">require_once</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">'/../database/QueryBuilder.php'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">CategoriaRepository</span> <span class="cm-keyword">extends</span> <span class="cm-variable">QueryBuilder</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">parent</span>::<span class="cm-variable">__construct</span>(<span class="cm-string">'categorias'</span>, <span class="cm-string">'Categoria'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 212px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 212px;"></div>
</div>
</div></pre>
<p><span>Modificamos también el controlador para añadir un nuevo </span><code>input</code><span> de tipo </span><code>select</code><span> con todas las categorías:</span></p>
<p><img src="assets/1542133337843.png" referrerpolicy="no-referrer" alt="1542133337843"></p>
<p><span>Y modificamos también la vista para que muestre la categoría. </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php+HTML" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php+html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 3.99744px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">table</span> <span class="cm-attribute">class</span>=<span class="cm-string">"table"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">thead</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"col"</span><span class="cm-tag cm-bracket">&gt;</span>#<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"col"</span><span class="cm-tag cm-bracket">&gt;</span>Imagen<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"col"</span><span class="cm-tag cm-bracket">&gt;</span>Visualizaciones<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"col"</span><span class="cm-tag cm-bracket">&gt;</span>Likes<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"col"</span><span class="cm-tag cm-bracket">&gt;</span>Descargas<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"col"</span><span class="cm-tag cm-bracket">&gt;</span>Categoría<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">thead</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tbody</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-meta">&lt;?php</span> <span class="cm-keyword">foreach</span> (<span class="cm-variable-2">$imagenes</span> <span class="cm-keyword">as</span> <span class="cm-variable-2">$imagen</span>): <span class="cm-meta">?&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">th</span> <span class="cm-attribute">scope</span>=<span class="cm-string">"row"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">th</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">img</span> <span class="cm-attribute">src</span>=<span class="cm-string">"</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getUrlGallery</span>(); <span class="cm-meta">?&gt;</span><span class="cm-string">"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                     <span class="cm-attribute">alt</span>=<span class="cm-string">"</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getDescripcion</span>(); <span class="cm-meta">?&gt;</span><span class="cm-string">"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                     <span class="cm-attribute">title</span>=<span class="cm-string">"</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getDescripcion</span>(); <span class="cm-meta">?&gt;</span><span class="cm-string">"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                     <span class="cm-attribute">width</span>=<span class="cm-string">"100px"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumVisualizaciones</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumLikes</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumDownloads</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getCategoria</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-meta">&lt;?php</span> <span class="cm-keyword">endforeach</span>; <span class="cm-meta">?&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tbody</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">table</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 661px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 661px;"></div>
</div>
</div></pre>
<p><span>Y este es el resultado:</span></p>
<p><img src="assets/1542126866630.png" referrerpolicy="no-referrer" alt="1542126866630"></p>
<p><span>Como podéis observar, en la columna categoría aparece el </span><strong><span>id</span></strong><span>, no el </span><strong><span>nombre</span></strong><span>. Vamos a modificar el código para que muestre la categoría. Para ello necesitamos un método en el repositorio de imágenes que nos devuelva la categoría (como objeto) de la imagen, por lo que crearemos un nuevo método en </span><code>QueryBuilder</code><span> llamado </span><code>findById()</code><span> al que le pasemos un </span><strong><span>id</span></strong><span> y nos devolverá la categoría correspondiente.</span></p>
<p><span>Primero refactorizamos </span><code>QueryBuilder</code><span>, creando un método genérico que nos permita realizar cualquier consulta (es una copia de </span><code>findAll</code><span>, pero se le pasa como parámetro la consulta SQL).</span></p>
<p><img src="assets/1566842854195.png" referrerpolicy="no-referrer" alt="1566842854195"></p>
<p><span>Luego refactorizamos </span><code>findAll</code><span>:</span></p>
<p><img src="assets/1542133405978.png" referrerpolicy="no-referrer" alt="1542133405978"></p>
<p><span>Y por último creamos el método </span><code>findById</code><span>:</span></p>
<p><img src="assets/1566842956797.png" referrerpolicy="no-referrer" alt="1566842956797"></p>
<p><span>Creamos también la excepción </span><code>NotFoundException</code><span>, dentro de la carpeta </span><code>exceptions</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16669px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">NotFoundException</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Exception</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">__construct</span>(<span class="cm-variable">string</span> <span class="cm-variable-2">$message</span>){</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">parent</span>::<span class="cm-variable">__construct</span>(<span class="cm-variable-2">$message</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Ya lo tenemos todo para modificar </span><code>ImagenGaleriaRepository</code><span>:</span></p>
<p><img src="assets/1542133442027.png" referrerpolicy="no-referrer" alt="1542133442027"></p>
<p><span>Y ahora ya podemos usarlo en </span><code>galeria.view.php</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php+HTML"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php+html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 3.99744px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$imagen</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNumDownloads</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$repositorio</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getCategoria</span>(<span class="cm-variable-2">$imagen</span>)<span class="cm-operator">-&gt;</span><span class="cm-variable">getNombre</span>(); <span class="cm-meta">?&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 53px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 53px;"></div>
</div>
</div></pre>
<p><span>Y este es el resultado:</span></p>
<p><img src="assets/1542127468136.png" referrerpolicy="no-referrer" alt="1542127468136"></p>
<h2 id="heading-13">
<a name="transacciones" class="md-header-anchor"></a><span>Transacciones</span>
</h2>
<p><span>Según la </span><a href="https://en.wikipedia.org/wiki/Database_transaction"><span>Wikipedia</span></a></p>
<blockquote>
<p><span>A </span><strong><span>transaction</span></strong><span> symbolizes a unit of work performed within a </span><a href="https://en.wikipedia.org/wiki/Database_management_system"><span>database management system</span></a><span>  (or similar system) against a database, and treated in a coherent and  reliable way independent of other transactions. A transaction generally  represents any change in a database. Transactions in a database  environment have two main purposes: </span></p>
<ol start="">
<li><span>To provide reliable units of work that allow correct recovery  from failures and keep a database consistent even in cases of system  failure, when execution stops (completely or partially) and many  operations upon a database remain uncompleted, with unclear status.</span></li>
<li><span>To provide isolation between programs accessing a database  concurrently. If this isolation is not provided, the programs' outcomes  are possibly erroneous.</span></li>
</ol>
<p><span>In a Database Management System, a transaction is a single unit of  logic or work, sometimes made up of multiple operations. Any logical  calculation done in a consistent mode in a database is known as a  transaction. One example is a transfer from one bank account to another:  the complete transaction requires subtracting the amount to be  transferred from one account and adding that same amount to the other. </span></p>
<p><span>A database transaction, by definition, must be </span><a href="https://en.wikipedia.org/wiki/Atomicity_(database_systems)"><span>atomic</span></a><span>, </span><a href="https://en.wikipedia.org/wiki/Consistency_(database_systems)"><span>consistent</span></a><span>, </span><a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)"><span>isolated</span></a><span> and </span><a href="https://en.wikipedia.org/wiki/Durability_(database_systems)"><span>durable</span></a><span>. Database practitioners often refer to these properties of database transactions using the acronym </span><a href="https://en.wikipedia.org/wiki/ACID"><span>ACID</span></a><span>. </span></p>
<p><span>Transactions provide an "all-or-nothing" proposition, stating  that each work-unit performed in a database must either complete in its  entirety or have no effect whatsoever. Further, the system must isolate  each transaction from other transactions, results must conform to  existing constraints in the database, and transactions that complete  successfully must get written to durable storage. </span></p>
</blockquote>
<p><span>Para empezar a trabajar con transacciones vamos a crear un método en </span><code>QueryBuilder</code><span> que permita ejecutar una transacción que recibirá como parámetro un </span><a href="https://www.php.net/manual/en/language.types.callable.php"><span>callable</span></a><span> que tenga todas las consultas a realizar, de tal forma que se ejecutan todas o ninguna. Hay que recordar que </span><strong><span>PDO</span></strong><span> funciona con </span><strong><span>autocommit</span></strong><span>, es decir que siempre que se ejecuta cualquier consulta de modificación de datos, esta se confirma automáticamente. Para modificar este comportamiento por defecto, es necesario primero llamar a </span><code>beginTransaction()</code></p>
<p><img src="assets/1566841619407.png" referrerpolicy="no-referrer" alt="1566841619407"></p>
<h3 id="heading-14">
<a name="ejemplo-de-uso" class="md-header-anchor"></a><span>Ejemplo de uso</span>
</h3>
<p><span>Vamos a hacer que cada vez que se inserte una imagen se actualice el campo </span><strong><span>numImagenes</span></strong><span> de la tabla </span><strong><span>categoria</span></strong><span>.</span></p>
<p><span>Para ello modificamos el método </span><code>save</code><span> en </span><code>ImagenGaleriaRepository</code><span> en el que haremos las dos cosas.</span></p>
<p><span>Primero crearemos un método en el repositorio de Categorías que nos permita actualizar el número de imágenes de la misma, que va a ser muy sencillo porque va a ser usar el getter y el setter. </span></p>
<p><span>Así que en </span><code>CategoriaRepository</code><span> creamos este nuevo método:</span></p>
<p><img src="assets/1542133486301.png" referrerpolicy="no-referrer" alt="1542133486301"></p>
<p><span>Pero nos hace falta modificar la clase </span><code>QueryBuilder</code><span> para que también permita actualizar y no sólo añadir como hasta ahora:</span></p>
<p><img src="assets/1566841811544.png" referrerpolicy="no-referrer" alt="1566841811544"></p>
<p><span>Una vez creados los métodos que nos hacen falta, sobrescribimos el método </span><code>save</code><span> en </span><code>ImagenGaleriaRepository</code><span>:</span></p>
<p><img src="assets/1566841931893.png" referrerpolicy="no-referrer" alt="1566841931893"></p>
<p><span>Estamos creando una función anónima (</span><strong><span>callable</span></strong><span>) con todas las instrucciones que se deben ejecutar como una transacción.</span></p>
<hr>
<h2 id="heading-15">
<a name="credits" class="md-header-anchor"></a><span>Credits.</span>
</h2>
<p><span>Víctor Ponz </span><a href="mailto:victorponz@gmail.com" target="_blank" class="url">victorponz@gmail.com</a></p>
<p><span>Este material está licenciado bajo una licencia </span><a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><span>Creative Commons, Attribution-NonCommercial-ShareAlike</span></a></p>
<p><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png" referrerpolicy="no-referrer"></p>
<p><span>Adaptado del curso </span><a href="https://www.udemy.com/desarrollo-web-con-php-7-y-mysql-utilizando-mvc/"><span>Desarrollo web con PHP y MVC</span></a><span>, realizado en el Cefire, impartido por </span><a href="https://www.udemy.com/user/alejandro-amat-reina/"><strong><span>Alejandro Amat Reina</span></strong></a></p>
<p> </p>
<p> </p>
<p> </p>
</div>      <div id='custom-footer'>
        <!--put here your custom footer -->
      </div>
    </div>
  </div><!--typora-export-->
</div><!--typora-container-->

<!-- jQuery first, then Bootstrap JS -->
  <script type="text/javascript">
   class TyporaToc {
  constructor (maxHeadingLevel = 6) {
    this.maxHeadingLevel = maxHeadingLevel;
    this.previous = null;
    this.topEl = document.querySelector(".top");
    let headings = "";
    for (let i = 1; i <= this.maxHeadingLevel; i++){
      headings += `h${i},`;
    }
    headings = headings.substr(0, headings.length - 1);
    this.allHeadings = document.querySelectorAll(headings);
    this.allTocAnchors = document.querySelectorAll(".md-toc-content a");
    this.currentTocAnchor = null;
    this.typoraContainer = document.querySelector(".typora-container");
    this.writeEl = document.querySelector("#write");
    this.codeMirrors = document.querySelectorAll('.CodeMirror-code');
    this.navNext = document.querySelector('#nav-next');
    this.navPrevious = document.querySelector('#nav-previous');
    this.typoraMenu = document.querySelector('.typora-menu');
    this.lastScrollTop = 0;
    this.lastActive = null;

    this.initEvents();
  }

  initEvents (){
    let oSelf = this;
    document.querySelector(".top .toogle").addEventListener('click', e => {
      e.preventDefault();
      let el = e.target;
      if (el.matches("i")){
        el = el.parentNode;
      }
      if (el.classList.contains('expanded')){
        oSelf.typoraContainer.classList.add('hide-menu');
      }else{
        oSelf.typoraContainer.classList.remove('hide-menu');
      }
      el.classList.toggle('expanded');
    });
    
    this.allTocAnchors.forEach(function(elem) {
      elem.addEventListener("click", e =>  {
          e.preventDefault();
          oSelf.allTocAnchors.forEach(function(anchor){
            anchor.classList.remove('active');
          })
          elem.classList.add("active");
          oSelf.currentTocAnchor = document.querySelector("[name='" + decodeURI(e.target.href.split("#")[1]) + "']");
          if (!oSelf.currentTocAnchor){
            //Chrome no decodeURI
            oSelf.currentTocAnchor = document.querySelector("[name='" + (e.target.href.split("#")[1]) + "']");
          }
          if (oSelf.currentTocAnchor){
            oSelf.currentTocAnchor.scrollIntoView({ behavior: 'smooth' })
            window.setTimeout(() =>location.hash = e.target.href.split("#")[1],500);
          }
          
      });
    });

    this.topEl.addEventListener('click', e => {
      e.preventDefault();
      
      let el = e.target;
      if (el.matches("i")){
          el = el.parentNode;
      }
      if ((el.getAttribute("id") === "nav-previous") || ((el.getAttribute("id") === "nav-next"))){
          let name =  el.getAttribute('href').split("#")[1];
          if (name !== "")
            location.hash = name;
      }
    });

    window.addEventListener('keydown', function(e) {
      
      if (e.keyCode == 39){
      	e.preventDefault();
        location.hash = oSelf.navNext.getAttribute("href");
      }else if(e.keyCode == 37){
      	e.preventDefault();
        location.hash = oSelf.navPrevious.getAttribute("href");
      }
    });

    window.onload = function(){

      //Add next and previous to headings
      for (let idx = 0; idx < oSelf.allHeadings.length; idx++) {
        let currentHeading = oSelf.allHeadings.item(idx);
        let next;
        
        if (oSelf.allHeadings.item(idx+1)){
          next = oSelf.allHeadings.item(idx+1).getElementsByTagName("a").item(0);
        }
        if (next){
          currentHeading.setAttribute("data-next", next.getAttribute("name"));
        }else{
          currentHeading.setAttribute("data-next", "");
        }
        if (oSelf.previous){
          currentHeading.setAttribute("data-previous", oSelf.previous.getAttribute("name"));
        }else{
          currentHeading.setAttribute("data-previous", "");
        }
        oSelf.previous = currentHeading.getElementsByTagName("a").item(0);
       
      }
    
      //Get hash, if any, to same document
      function getAnchor() {
        var currentUrl = document.URL,
        urlParts   = currentUrl.split('#');
        
        return (urlParts.length > 1) ? urlParts[1] : null;
      }
    
      //Activate link to hash
      let anchor = getAnchor();
    
      let curTocEl =  document.querySelector("[href='" + anchor + "']");
      if (curTocEl)
        curTocEl.classList.add("active");
    
    }

    window.addEventListener('scroll', function(e) {
      var st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
        if (st > oSelf.lastScrollTop){
          oSelf.allHeadings.forEach(function(heading) {
            if (oSelf.isAnyPartOfElementInViewport(heading)){
              oSelf.navPrevious.setAttribute("href", "#" + heading.getAttribute("data-previous"));
              oSelf.navNext.setAttribute("href", "#" + heading.getAttribute("data-next"));
              oSelf.typoraMenu.querySelectorAll("a").forEach(function(anchor){
                anchor.classList.remove('active');
              });
              oSelf.lastActive = oSelf.typoraMenu.querySelector( "#anchor-" + heading.getAttribute('id'));
              oSelf.lastActive.classList.add('active');
              if (!oSelf.isAnyPartOfElementInViewport(oSelf.lastActive)){
                oSelf.lastActive.scrollIntoView();
              }
            }
          } 
        );
       } else {
        let notFound = true; 
        oSelf.allHeadings.forEach(function(heading) {
            if (oSelf.isAnyPartOfElementInViewport(heading)){
              oSelf.navPrevious.setAttribute("href", "#" + heading.getAttribute("data-previous"));
              oSelf.navNext.setAttribute("href", "#" + heading.getAttribute("data-next"));
              notFound = false;
              oSelf.typoraMenu.querySelectorAll("a").forEach(function(anchor){
                anchor.classList.remove('active');
              });
              oSelf.lastActive = oSelf.typoraMenu.querySelector( "#anchor-" + heading.getAttribute('id'));
              oSelf.lastActive.classList.add('active');
              if (!oSelf.isAnyPartOfElementInViewport(oSelf.lastActive)){
                oSelf.lastActive.scrollIntoView();
              }
            }
          } 
        );
        if (notFound){
          oSelf.typoraMenu.querySelectorAll("a").forEach(function(anchor){
            anchor.classList.remove('active');
          });
          if (oSelf.lastActive){
            let lastId = oSelf.lastActive.getAttribute("id").split("-")[2] - 1;
            let t = oSelf.typoraMenu.querySelector( "#anchor-heading-" + lastId);
            if (t){
              t.classList.add('active');
              if (!oSelf.isAnyPartOfElementInViewport(t)){
                t.scrollIntoView();
                oSelf.navPrevious.setAttribute("href", "#" + t.getAttribute("data-previous"));
                oSelf.navNext.setAttribute("href", "#" + t.getAttribute("data-next"));
              }
            }
          }
        }
       }
       oSelf.lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
    });
    //In some browsers (Mozilla Firefox), there are some strange characters in codeMirror so if you cut and paste code
    //it doesn't compile because of these characters
    this.codeMirrors.forEach(function(elem) {
      let lines = elem.querySelectorAll('pre > span');
      lines.forEach(function(line){
        line.innerHTML = (line.innerHTML.replace(/[\u0250-\ue007]/g, ''));
        let spans =  line.querySelectorAll("span");
        spans.forEach(function(span){
          span.textContent = (span.textContent.replace(/[\u0250-\ue007]/g, ''));
        });
          
      });
    });

  }

  isAnyPartOfElementInViewport(el) {

    const rect = el.getBoundingClientRect();
    // DOMRect { x: 8, y: 8, width: 100, height: 100, top: 8, right: 108, bottom: 108, left: 8 }
    const windowHeight = (window.innerHeight || document.documentElement.clientHeight);
    const windowWidth = (window.innerWidth || document.documentElement.clientWidth);
    
    // http://stackoverflow.com/questions/325933/determine-whether-two-date-ranges-overlap
    const vertInView = (rect.top <= windowHeight) && ((rect.top + rect.height) >= 0);
    const horInView = (rect.left <= windowWidth) && ((rect.left + rect.width) >= 0);
    
    return (vertInView && horInView);
  }
}
   let toc = new TyporaToc(6);
  </script>
</body>
</html>
